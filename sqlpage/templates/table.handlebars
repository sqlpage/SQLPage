<div class="card my-2 {{class}}" {{#if overflow}}style="width: fit-content;"{{/if}} {{#if id}}id="{{id}}"{{/if}}>
    <div class="card-body p-0" data-pre-init="table">
        {{#if (or search initial_search_value)}}
        <div class="p-3">
            <input
                type="search"
                class="form-control form-control-rounded fs-6 search"
                placeholder="Searchâ€¦"
                value="{{initial_search_value}}"
                {{#if initial_search_value}}autocomplete="off"{{/if}}
            >
        </div>
        {{/if}}
        <div class="table-responsive
            {{~#if freeze_columns}} table-freeze-columns text-nowrap {{/if~}}
            {{~#if freeze_headers}} table-freeze-headers text-nowrap {{/if~}}
            {{~#if freeze_footers}} table-freeze-footers text-nowrap {{/if~}}
        ">
            <table class="table
            {{~#if striped_rows}} table-striped {{/if~}}
            {{~#if striped_columns}} table-striped-columns {{/if~}}
            {{~#if hover}} table-hover {{/if~}}
            {{~#if border}} table-bordered {{/if~}}
            {{~#if small}} table-sm {{/if~}}
            "
            {{~#if number_format_locale}} data-number_format_locale="{{number_format_locale}}"{{/if~}}
            {{~#if number_format_digits}} data-number_format_digits="{{number_format_digits}}"{{/if~}}
            {{~#if currency}} data-currency="{{currency}}"{{/if~}}
            >
            {{#if description}}<caption class="text-center text-muted">{{description}}</caption>{{/if}}
                {{#each_row}}
                    {{#if (eq @row_index 0)}}
                        {{! Since we are inside the first data row, we always start with the header }}
                        <thead>
                        <tr>
                            {{#each this}}
                                {{#if (not (starts_with @key '_sqlpage_'))}}
                                <th class="
                                    _col_{{replace @key ' ' '_'~}}
                                    {{~#if (array_contains_case_insensitive ../../align_right @key)}} text-end {{/if~}}
                                    {{~#if (array_contains_case_insensitive ../../align_center @key)}} text-center {{/if~}}
                                "
                                    data-column_type="{{typeof this}}"
                                    {{~#if (array_contains_case_insensitive ../../raw_numbers @key)}} data-raw_number="1"{{/if~}}
                                    {{~#if (array_contains_case_insensitive ../../money @key)}} data-money="1"{{/if~}}
                                >
                                    {{~#if ../../sort~}}
                                        <button class="table-sort sort d-inline" data-sort="{{@key}}">{{@key}}</button>
                                    {{~else~}}
                                        {{~@key~}}
                                    {{~/if~}}
                                </th>
                                {{/if}}
                            {{/each}}
                        </tr>
                        </thead>
                        {{! For the first row we have two choices, depending on the first_row_is_footer variable }}
                        {{#if ../first_row_is_footer}}
                            {{! If first row is the footer we open the <tfoot> tag, while the <tbody> will be added after this row is rendered }}
                            <tfoot>
                        {{else}}
                            {{! If there is no footer we open the <tbody> now, with a 'delay'ed closure }}
                            <tbody class="table-tbody list">{{#delay}}</tbody>{{/delay}}
                        {{/if}}
                    {{~/if~}}

                    {{! Regardless of which row we are in, this part of the template renders the row data }}
                    <tr class="{{_sqlpage_css_class}} {{#if _sqlpage_color}}bg-{{_sqlpage_color}}-lt{{/if}}" {{#if _sqlpage_id}}id="{{_sqlpage_id}}"{{/if}}>
                        {{~#each this~}}
                            {{~#if (not (starts_with @key '_sqlpage_'))~}}
                            <td class="align-middle _col_{{replace @key ' ' '_'~}}
                                {{~#if (array_contains_case_insensitive ../../align_right @key)}} text-end {{/if~}}
                                {{~#if (array_contains_case_insensitive ../../align_center @key)}} text-center {{/if~}}
                            ">
                                {{~#if (array_contains_case_insensitive ../../markdown @key)~}}
                                    {{{markdown this}}}
                                {{~else~}}
                                {{~#if (array_contains_case_insensitive ../../icon @key)~}}
                                    {{~icon_img this~}}
                                {{~else~}}
                                    {{this}}
                                {{~/if~}}
                                {{~/if~}}
                            </td>
                            {{/if~}}
                        {{~/each~}}
                    </tr>

                    {{! After this <tr> has been rendered, we need to check again if there is more work to do done }}
                    {{#if (eq @row_index 0)}}
                        {{#if ../first_row_is_footer}}
                            {{! If the first row was the footer, 2 things must happen: we need to close the <tfoot> tag }}
                            </tfoot>
                            {{! and since it was not done before, the <tbody> tag needs to be added now, with a delayed </tbody> }}
                            <tbody class="table-tbody list">{{#delay}}</tbody>{{/delay}}
                        {{/if}}
                    {{~/if~}}
                {{/each_row}}
                {{flush_delayed}}

                {{! If not enough rows were rendered, we need to place a 'No data' cell. "Not enough rows" depends on the footer settings }}
                {{#if ../first_row_is_footer}}
                    {{#if (lte @row_index 1)}}
                        <tbody class="table-tbody list">
                            <tr>
                                <td class="text-center">{{default empty_description 'No data'}}</td>
                            </tr>
                        </tbody>
                    {{/if}}
                {{else}}
                    {{#if (eq @row_index 0)}}
                        <tbody class="table-tbody list">
                            <tr>
                                <td class="text-center">{{default empty_description 'No data'}}</td>
                            </tr>
                        </tbody>
                    {{/if}}
                {{~/if~}}
            </table>
        </div>
    </div>
</div>
